CREATE TABLE PRODUCT(
    MODEL VARCHAR(32),
    MAKER VARCHAR(32),
    TYPE ENUM("PC", "Laptop", "Printer"),
    PRIMARY KEY (MODEL)
);

CREATE TABLE PC(
    CODE VARCHAR(32),
    MODEL VARCHAR(32),
    SPEED FLOAT,
    RAM INT(4),
    HD INT(4),
    CD INT(4),
    PRICE DECIMAL,
    PRIMARY KEY (CODE),
    FOREIGN KEY (MODEL) REFERENCES PRODUCT(MODEL)
);


CREATE TABLE LAPTOP(
    CODE VARCHAR(32),
    MODEL VARCHAR(32),
    SPEED FLOAT,
    RAM INT(4),
    HD INT(4),
    SCREEN INT(4),
    PRICE DECIMAL,
    PRIMARY KEY (CODE),
    FOREIGN KEY (MODEL) REFERENCES PRODUCT(MODEL)
);

CREATE TABLE PRINTER(
    CODE VARCHAR(32),
    MODEL VARCHAR(32),
    COLOR ENUM("y", "n"),
    TYPE ENUM("Laser", "Jet", "Matrix"),
    PRICE DECIMAL,
    PRIMARY KEY (CODE),
    FOREIGN KEY (MODEL) REFERENCES PRODUCT(MODEL)
);

INSERT INTO PRODUCT(MODEL, MAKER, TYPE) VALUES
("MODEL 1", "ASUS", "PC"),
("MODEL 2", "ASUS", "Laptop"),
("MODEL 3", "ASUS", "Printer"),
("MODEL 4", "Apple", "Laptop"),
("MODEL 5", "HP", "Laptop"),
("MODEL 6", "HP", "Printer"),
("MODEL 7", "HP", "Printer"),
("MODEL 8", "HP", "Printer"),
("MODEL 9", "HP", "Printer"),
("MODEL 10", "Toshiba", "Laptop");

INSERT INTO PC(CODE, MODEL, SPEED, RAM, HD, CD, PRICE) VALUES
("PC 1", "MODEL 1", 2.7, 2, 512, 8, 1229.30);

INSERT INTO LAPTOP(CODE, MODEL, SPEED, RAM, HD, SCREEN, PRICE) VALUES
("LAPTOP 1", "MODEL 2", 2.7, 2, 512, 8, 229.30),
("LAPTOP 2", "MODEL 4", 2.7, 2, 512, 8, 229.30),
("LAPTOP 3", "MODEL 5", 2.7, 2, 512, 8, 229.30),
("LAPTOP 4", "MODEL 5", 2.7, 2, 512, 9, 229.30),
("LAPTOP 5", "MODEL 10", 2.7, 2, 512, 10, 229.30);

INSERT INTO PRINTER(CODE, MODEL, COLOR, TYPE, PRICE) VALUES
("PRINTER 1", "MODEL 3", "y", "Laser", 30.30),
("PRINTER 2", "MODEL 6", "y", "Jet", 10.30),
("PRINTER 3", "MODEL 6", "y", "Matrix", 80.30),
("PRINTER 4", "MODEL 6", "y", "Matrix", 60.30),
("PRINTER 5", "MODEL 6", "y", "Laser", 40.30);

/* Task 1 */

SELECT DISTINCT MAKER
FROM PRODUCT
WHERE PRODUCT.TYPE = "PC"
AND MAKER IN (
    SELECT MAKER
    FROM PRODUCT
    JOIN LAPTOP ON PRODUCT.MODEL = LAPTOP.MODEL
)

SELECT MAKER
FROM PRODUCT
WHERE TYPE="PC"
UNION
SELECT MAKER
FROM PRODUCT
WHERE TYPE="LAPTOP";

SELECT MAKER
FROM PRODUCT P1
CROSS JOIN PRODUCT P2
WHERE P1.MAKER = P2.MAKER AND
P1.TYPE = "PC" AND P2.TYPE = "Laptop"
GROUP BY MAKER;

/* Task 2*/

SELECT CODE, L.MODEL, SCREEN
FROM LAPTOP L
INNER JOIN PRODUCT P ON L.MODEL = P.MODEL
WHERE MAKER NOT IN (
    SELECT MAKER
    FROM PRODUCT
    WHERE TYPE = "Printer"
    GROUP BY MAKER
    HAVING COUNT(*) > 3
);

SELECT CODE, L.MODEL, SCREEN
FROM PRODUCT P
LEFT JOIN LAPTOP L ON L.MODEL = P.MODEL
HAVING COUNT(
    SELECT *
    FROM PRODUCT
    WHERE MAKER = P.MAKER
    AND TYPE = "Printer"
) <= 3;


select code, l.model, screen
from product p
left join laptop l
on p.model = l.model
having count(select *
from product
where maker = p.maker
and type = 'Printer') <= 3;