CREATE TABLE STUDIO(
    NAME VARCHAR(64),
    ADDRESS VARCHAR(256),
    PRIMARY KEY (NAME)
);

CREATE TABLE MOVIE(
    TITLE VARCHAR(64),
    YEAR INT(4),
    LENGTH INT,
    INCOLOR ENUM("Y", "N"),
    STUDIONAME VARCHAR(64),
    PRIMARY KEY(TITLE, YEAR),
    FOREIGN KEY (STUDIONAME) REFERENCES STUDIO(NAME)
);

CREATE TABLE MOVIESTAR(
    NAME VARCHAR(64),
    ADDRESS VARCHAR(256),
    GENDER ENUM("M", "F"),
    BIRTHDATE DATE,
    PRIMARY KEY (NAME)
);

CREATE TABLE STARSIN(
    MOVIETITLE VARCHAR(64),
    MOVIEYEAR INT(4),
    STARNAME VARCHAR(32),
    PRIMARY KEY (MOVIETITLE, MOVIEYEAR, STARNAME),
    FOREIGN KEY (STARNAME) REFERENCES MOVIESTAR(NAME),
    FOREIGN KEY (MOVIETITLE, MOVIEYEAR) REFERENCES MOVIE(TITLE, YEAR)
);

INSERT INTO STUDIO(NAME, ADDRESS) VALUES
("STUDIO 1", "ADDRESS 1"),
("STUDIO 2", "ADDRESS 2"),
("STUDIO 3", "ADDRESS 3");

INSERT INTO MOVIE(TITLE, YEAR, LENGTH, INCOLOR, STUDIONAME) VALUES
("MOVIE 1", 1994, 100, "Y", "STUDIO 1"),
("MOVIE 2", 2000, 100, "N", "STUDIO 1"),
("MOVIE 3", 2009, 100, "Y", "STUDIO 2"),
("MOVIE 4", 1965, 100, "Y", "STUDIO 2");

INSERT INTO MOVIESTAR(NAME, ADDRESS, GENDER, BIRTHDATE) VALUES
("STAR 1", "ADDRESS 1", "M", 1972-08-28),
("STAR 2", "ADDRESS 1", "F", 1973-08-30),
("STAR 3", "ADDRESS 1", "F", 1973-09-08);

INSERT INTO STARSIN(MOVIETITLE, MOVIEYEAR, STARNAME) VALUES
("MOVIE 1", 1994, "STAR 1"),
("MOVIE 2", 2000, "STAR 1"),
("MOVIE 3", 2009, "STAR 1"),
("MOVIE 4", 1965, "STAR 2");

/** Task 1 **/
SELECT NAME
FROM MOVIESTAR
WHERE NAME NOT IN (
    SELECT DISTINCT STARNAME
    FROM STARSIN
    WHERE MOVIEYEAR > 1970
);

SELECT DISTINCT NAME
FROM MOVIESTAR
LEFT JOIN STARSIN ON NAME=STARNAME
WHERE MOVIEYEAR<=1970;

SELECT NAME
FROM MOVIESTAR
JOIN STARSIN ON STARNAME=NAME
WHERE MOVIEYEAR > 1970
GROUP BY NAME
HAVING COUNT(*) = 0;

SELECT M.NAME
FROM MOVIESTAR M
WHERE EXISTS (
    SELECT 1
    FROM STARSIN S
    WHERE S.STARNAME = M.NAME
    AND S.MOVIEYEAR <= 1970
);

/* Task 2 */
SELECT NAME, MIN(MOVIEYEAR - YEAR(BIRTHDATE)) AS DEBUT_AGE
FROM STARSIN
JOIN MOVIESTAR ON STARNAME = NAME
GROUP BY NAME;

SELECT NAME, MIN(MOVIEYEAR) - YEAR(BIRTHDATE) AS DEBUT_AGE
FROM MOVIESTAR
NATURAL JOIN STARSIN ON NAME=STARNAME
GROUP BY NAME;

SELECT NAME, MOVIEYEAR - YEAR(BIRTHDATE) AS DEBUT_AGE
FROM MOVIESTAR
LEFT JOIN STARSIN ON NAME = STARNAME
WHERE MOVIEYEAR IS NOT NULL
GROUP BY NAME
HAVING MIN(MOVIEYEAR);

SELECT DISTINCT MS.NAME, MOVIEYEAR - YEAR(BIRTHDATE) AS DEBUT_AGE
FROM MOVIESTAR MS, STARSIN
HAVING MS.NAME = STARNAME AND
MOVIEYEAR <= ALL (
    SELECT MOVIEYEAR
    FROM STARSIN SI
    WHERE SI.STARNAME = MS.NAME
)